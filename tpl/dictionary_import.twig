{##
 # dictionary_import.twig
 # 
 # Used to upload participant CSV data files
 # @author Dean Inglis <inglisd@mcmaster.ca>
 #}
{% extends "widget.twig" %}

{% block javascript %}
  <script type="text/javascript">
    $( function() {
      $( "#{{ widget.full }}__file" ).change( function() {
        var file = this.files[0];
        if( 0 == file.size ) {
          alert( "Unable to proceed, the file you selected is empty." );
          $(this).val( "" );
        }

        $( "#{{ widget.full }}__import" ).button( { disabled: "" == $(this).val() } );
      } );

      $( "#{{ widget.full }}__form" ).bind( "submit", function(e) {
        e.preventDefault();
        var file = document.getElementById( "{{ widget.full }}__file" ).files[0];
        var reader = new FileReader();
        reader.onload = function(e) {
          var args = new Object();
          args.file_data = e.target.result;
          args.id = "{{ dictionary_id }}";
          var data = ajax_pull( "dictionary", "import", args );
        };
        reader.readAsBinaryString( file );
/*
        if( undefined != data ) {
          var html = '<table style="width:34%; margin-left:33%; margin-right:33%">';
          for( var key in data )
          {
            html += '<tr><td class="heading">' + key +
                    '</td><td>' + data[key] +
                    '</td></tr>';
            if( 0 < data[key] ) allow_proceed = true;
          }
          html += '</table>' +
                  '<div class="spacer" style="text-align: right">' +
                  '<button id="{{ widget.full }}__proceed" style="width:120px"' +
                  ( allow_proceed ? '' : ' disabled' ) +
                  '>Proceed</button>' +
                  '</div>';
          $( "#{{ widget.full }}__results" ).html( html );
          $( "#{{ widget.full }}__proceed" ).button();
        }

        $( "#{{ widget.full }}__proceed" ).click( function () {
          var args = new Object();
          $( "#{{ widget.full }}_form :input" ).each( function() {
            var id_string = $(this).attr( "id" );
            var param_name = id_string.substring( id_string.lastIndexOf('__') + 2 );
            if( "update" != param_name )
              args[param_name] = "checkbox" == $(this).attr( "type" )
                               ? ( $(this).is( ":checked" ) ? 1 : 0 )
                               : $(this).val();
          } );
          if( ajax_push( "dictionary", "import", args ) ) {
            // let the user know the operation is complete and delete the proceed button
            $(this).remove();
            alert( "The operation was successful." );
          }
        } );*/
      } ); 
    } );
  </script>
{% endblock javascript %}

{% block widget %}
  <div class="ui-widget ui-widget-content app-widget-content">
    <div class="spacer">
      Upload new words using a CSV (comma separated values) file where
      all words are enclosed by double quotes (&quot;)
    </div>
    <form id="{{ widget.full }}__form" action="" enctype="multipart/form-data">
      <input type="hidden" name="MAX_FILE_SIZE" value="64000000" />
      <table>
        <tr>
          <td class="heading">
            <span class="title">CSV file to import:</span>
          </td>
          <td class="content">
            <input type="file" 
                   id="{{ widget.full }}__file" name="file" />
          </td>
          <td class="content">
            <button id="{{ widget.full }}__import" style="width:150px;" disabled>Import</button>
          </td>
        </tr>
      </table>
    </form>

    {% from 'macros.twig' import confirm_buttons %}
    {{ confirm_buttons( slot, widget.full, 'proceed', false, 'left', true ) }}
  </div>
{% endblock widget %}

