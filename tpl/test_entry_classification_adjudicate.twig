{##
 # test_entry_classfication_adjudicate.twig
 # 
 # Adjudicate a classification type test.
 # @author Dean Inglis <inglisd@mcmaster.ca>
 # @see base_view.twig for parameters
 #}
{% extends "widget.twig" %}

{% block javascript %}
  {{ parent() }}
  <script type="text/javascript">

    function configure_ui() {
      var disable = $( 'input:radio[value="accept"]:checked' ).length == 
                    ( $( 'input:radio[value="accept"]' ).length / 2 )  ? false : true;
      $("#{{ parent.full }}_Submit").button( { disabled : disable } );        
    }

    $( function () {

      configure_ui();

      $( "#{{ widget.full }}__entry_table" ).find( 'input:radio[value="accept"]' ).change(
        function() {
        var entry_id = $(this).attr( "id" ).split( "__" )[0];
        var target_text_id = '#' + $(this).attr( "name" ) + "__adjudicate";
        var source_text_id = '#' + entry_id + "__candidate";
        $( target_text_id ).val( $( source_text_id ).val() );
        $( target_text_id ).removeAttr( "disabled" );

        configure_ui();
      } ); // end radio input change

      // TODO handle changes to adjudicate text input by the administrator
      // if the new entry differs from the progenetors, uncheck their radio inputs
      // check that the word is not empty, if it is, 

      $( "#{{ widget.full }}__entry_table" ).find( 'input:text[id$="adjudicate"]' ).change( function() {
        if( $(this).val().length == 0 ) {
          error_dialog( "Error", "Blank entry not permitted." );

          // refill with the corresponding accepted text entry
          var id_1 = '#' + $(this).attr( "id" ).split( "__" )[0] + "__accept";
          var id_2 = '#' + $(this).attr( "id" ).split( "__" )[1] + "__accept"
          if( $( id_1 ).attr( "checked" ) ) {
            var text_id = id_1.replace( "accept", "candidate" );
            $(this).val( $( text_id ).val() );
          } else if ( $( id_2 ).attr("checked") ) {
            var text_id = id_2.replace( "accept", "candidate" );
            $(this).val( $( text_id ).val() );
          } else {
            // disable and uncheck the accept radio inputs
            $( id_1 ).removeAttr( "checked" );
            $( id_2 ).removeAttr( "checked" );
            $(this).attr( "disabled", "disabled" );
          }
        }
        configure_ui();
      } );// end text input change 

    } );
  </script>

{% endblock javascript %}

{% block widget %}

  <div class="spacer">

  <table id="{{ widget.full }}__entry_table"
         border="1">

    <thead>
      <tr style="height:40px">
        <th>Entry #</th>
        <th colspan="2">{{ user_1 }}</th>
        <th colspan="2">{{ user_2 }}</th>
        <th colspan="2">Adjudicate</th>
      </tr>
    </thead>

    <tbody>
    {% for entry in entry_data %}
      <tr>
        <td class="heading">{{ entry.rank }}</td>

          {% set value_1 = '' %}
          {% set value_2 = '' %}
          {% if entry.word_id_1 is defined %}
            {% set value_1 = entry.word_1 %}
          {% elseif entry.word_candidate_1 is defined %}
            {% set value_1 = entry.word_candidate_1 %}
          {% endif %}
          {% if entry.word_id_2 is defined %}
            {% set value_2 = entry.word_2 %}
          {% elseif entry.word_candidate_2 is defined %}
            {% set value_2 = entry.word_candidate_2 %}
          {% endif %}

          <td><input type="text"
               id="{{ entry.id_1 }}__candidate"
               value={{ value_1 }}></td>
          <td bgcolor=#B1F3B1><input type="radio"
               id="{{ entry.id_1 }}__accept"
               name="{{ entry.id_1 }}__{{ entry.id_2 }}"
               value="accept">
               <label for="{{ entry.id_1 }}__accept">Accept</label></td>

          <td><input type="text"
               id="{{ entry.id_2 }}__candidate"
               value={{ value_2 }}></td>
          <td bgcolor=#B1F3B1><input type="radio"
               id="{{ entry.id_2 }}__accept"
               name="{{ entry.id_1 }}__{{ entry.id_2 }}"
               value="accept">
               <label for="{{ entry.id_2 }}__accept">Accept</label></td>

          <td><input type="text"
               id="{{ entry.id_1 }}__{{ entry.id_2 }}__adjudicate"
               disabled="disabled"
               value=""></td>
      </tr>
    {% endfor %}
    </tbody>
  </table>

{% endblock widget %}

